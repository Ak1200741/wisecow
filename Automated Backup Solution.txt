#!/bin/bash

# Configuration variables - adjust these according to your setup
LOCAL_DIR="/path/to/your/local/directory"      # Directory to be backed up
REMOTE_HOST="your-remote-server.com"           # Remote server hostname or IP
REMOTE_USER="username"                         # Remote server username
REMOTE_DIR="/path/to/remote/directory"         # Directory on remote server where backups will be stored

# Function to create a timestamp for log messages
timestamp() {
    date +"%Y-%m-%d %T"
}

# Function to perform the backup
perform_backup() {
    # Create a timestamped backup file name
    BACKUP_FILE="backup-$(date +'%Y%m%d%H%M%S').tar.gz"

    # Perform the backup using tar
    tar czf "$BACKUP_FILE" "$LOCAL_DIR"

    # Check if backup was successful
    if [ $? -eq 0 ]; then
        echo "[ $(timestamp) ] Backup successfully created: $BACKUP_FILE"

        # Transfer the backup file to remote server using scp
        scp "$BACKUP_FILE" "$REMOTE_USER@$REMOTE_HOST:$REMOTE_DIR/"

        # Check if transfer was successful
        if [ $? -eq 0 ]; then
            echo "[ $(timestamp) ] Backup successfully transferred to remote server."
            rm "$BACKUP_FILE"  # Remove local backup file after successful transfer
            echo "[ $(timestamp) ] Local backup file removed."
            echo "[ $(timestamp) ] Backup process completed successfully."
            exit 0
        else
            echo "[ $(timestamp) ] Failed to transfer backup to remote server."
            exit 1
        fi
    else
        echo "[ $(timestamp) ] Backup creation failed."
        exit 1
    fi
}

# Perform the backup operation
perform_backup